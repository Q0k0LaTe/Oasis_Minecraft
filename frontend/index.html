<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ModGen Studio AI</title>
    
    <!-- OPTIMIZATION: Preconnect -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    
    <!-- FONTS: Silkscreen (Branding), Inter (UI), JetBrains Mono (Code) -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=JetBrains+Mono:wght@400;500&family=Silkscreen:wght@400;700&display=swap" rel="stylesheet">
    
    <!-- Google Identity Services -->
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    
    <link rel="stylesheet" href="assets/css/style.css">
</head>
<body>
    <!-- THE PIXEL BACKGROUND (Optimized) -->
    <div class="background-pattern"></div>
    <div class="background-vignette"></div>

    <div class="app-layout">
        <!-- SIDEBAR: Navigation & History -->
        <aside class="sidebar">
            <div class="brand">
                <div class="brand-icon"></div>
                <h1>MODGEN<span class="brand-accent">.AI</span></h1>
            </div>

            <div class="nav-section">
                <div class="nav-label">Workspace</div>
                <button class="nav-item active" id="navGenerator" data-target="generator">
                    <span class="icon">‚ú®</span> Generator
                </button>
                <button class="nav-item" id="navAssets" data-target="assets">
                    <span class="icon">üì¶</span> My Assets
                </button>
            </div>

            <div class="nav-section">
                <div class="nav-label">Recent Generations</div>
                <div id="historyList" class="history-list">
                    <!-- History items injected via JS -->
                    <div class="history-item">
                        <span class="dot-indicator" style="background: #55ffff"></span>
                        <span class="history-text">Diamond Staff</span>
                    </div>
                </div>
            </div>

            <div class="user-profile" id="userProfile" style="display: none;">
                <div class="avatar" id="userAvatar">S</div>
                <div class="user-info">
                    <div class="username" id="userUsername">Steve_Dev</div>
                    <div class="status" id="userStatus">Pro Plan</div>
                </div>
            </div>
            <div class="user-profile" id="loginPrompt">
                <a href="login.html" class="btn-primary" style="text-decoration: none; display: inline-block;">Login / Sign Up</a>
            </div>
        </aside>

        <!-- MAIN CONTENT -->
        <main class="main-content">
            <!-- Header -->
            <header class="top-bar">
                <div class="model-selector">
                    <span class="icon-pixel">ü§ñ</span>
                    <select>
                        <option>Fabric-21 (Stable)</option>
                        <option>Forge-1.20 (Legacy)</option>
                    </select>
                </div>
                <div class="header-actions">
                    <button class="btn-text" id="docsBtn">Documentation</button>
                    <button class="btn-primary" id="exportBtn">Export .jar</button>
                </div>
            </header>

            <!-- Workspace Split -->
            <div class="workspace-grid">
                
                <!-- INPUT COLUMN -->
                <section class="panel input-panel">
                    <div class="panel-header">
                        <h3><span class="icon">‚å®Ô∏è</span> Prompt Engineering</h3>
                    </div>
                    <div class="input-container">
                        <textarea 
                            id="itemPrompt" 
                            placeholder="// Describe your item logic...&#10;> Create a legendary obsidian sword that applies Wither effect and glows purple."
                            spellcheck="false"
                        ></textarea>
                        
                        <div class="worklist-panel" id="worklistPanel">
                            <div class="worklist-toolbar">
                                <div class="worklist-type-select">
                                    <label for="worklistType">Category</label>
                                    <select id="worklistType">
                                        <option value="ITEM">Item</option>
                                        <option value="TOOL">Tool</option>
                                        <option value="BLOCK">Block</option>
                                    </select>
                                </div>
                                <div class="worklist-toolbar-actions">
                                    <button id="addWorklistBtn" class="btn-secondary">
                                        <span class="btn-icon">‚ûï</span> Add to list
                                    </button>
                                    <button id="clearWorklistBtn" class="btn-ghost">Clear</button>
                                </div>
                            </div>
                            <p class="worklist-summary" id="worklistSummary">No entries queued. Add prompts to build a batch.</p>
                            <div class="worklist-grid">
                                <div class="worklist-column">
                                    <div class="worklist-column-header">
                                        <span>Items</span>
                                        <span class="worklist-count" id="itemWorklistCount">0</span>
                                    </div>
                                    <div class="worklist-list" id="itemWorklist"></div>
                                </div>
                                <div class="worklist-column">
                                    <div class="worklist-column-header">
                                        <span>Tools</span>
                                        <span class="worklist-count" id="toolWorklistCount">0</span>
                                    </div>
                                    <div class="worklist-list" id="toolWorklist"></div>
                                </div>
                                <div class="worklist-column">
                                    <div class="worklist-column-header">
                                        <span>Blocks</span>
                                        <span class="worklist-count" id="blockWorklistCount">0</span>
                                    </div>
                                    <div class="worklist-list" id="blockWorklist"></div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="input-actions">
                            <span class="input-hint">Queue multiple ideas above, then run the agent to build everything at once.</span>
                            <button id="generateBtn" class="btn-generate">
                                <span class="btn-icon">‚ö°</span> Generate All
                            </button>
                        </div>
                    </div>
                </section>

                <!-- OUTPUT COLUMN -->
                <section class="panel output-panel">
                    <div class="panel-header">
                        <h3><span class="icon">üëÅÔ∏è</span> Live Preview</h3>
                        <div class="status-badge" id="statusBadge">Ready</div>
                    </div>
                    
                    <div class="output-canvas" id="outputCanvas">
                        <!-- Status Log (Expanded) -->
                        <div class="status-log-panel">
                            <div class="status-log-header">
                                <div class="log-lights">
                                    <span class="log-light red"></span>
                                    <span class="log-light amber"></span>
                                    <span class="log-light green"></span>
                                </div>
                                <span class="log-title">Agent Working</span>
                                <span class="log-status" id="logStatusLabel">standby</span>
                            </div>
                            <div class="status-log" id="statusLog">
                                <div class="status-log-entry">
                                    <span class="log-chevron">‚ñ∏</span>
                                    <span class="log-text">Ready for your prompt.</span>
                                </div>
                            </div>
                        </div>

                        <!-- Empty State -->
                        <div class="empty-state" id="emptyState">
                            <div class="grid-placeholder"></div>
                            <p>Generate a fully playable Fabric mod without leaving this tab.</p>
                            <p class="empty-hint">Try ‚ÄúConjure a frostbite hammer that freezes water as you walk.‚Äù</p>
                        </div>

                        <!-- Result Card -->
                        <div class="result-card" id="resultCard" style="display: none;">
                            <div class="card-glass">
                                <div class="preview-section">
                                    <div class="render-box">
                                        <div id="resultIcon" class="pixel-render"></div>
                                    </div>
                                    <div class="meta-section">
                                        <h2 id="resultName">Obsidian Sword</h2>
                                        <code id="resultId">mod:obsidian_sword</code>
                                        <div class="tags" id="resultTags">
                                            <span class="tag rarity-epic">EPIC</span>
                                            <span class="tag">COMBAT</span>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="code-section">
                                    <div class="code-tabs">
                                        <span class="tab active">Plan</span>
                                    </div>
                                    <pre><code id="resultCode" class="language-java">// AI generating code...</code></pre>
                                </div>

                                <div class="detail-section" id="detailSection">
                                    <!-- Populated via JS -->
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

            </div>
        </main>
    </div>

    <!-- Loading Overlay (Minimal) -->
    <div id="loadingOverlay" class="loading-bar-container" style="display: none;">
        <div class="loading-bar"></div>
    </div>

    <!-- Login Modal -->
    <div id="loginModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Login / Sign Up</h2>
                <button class="modal-close" id="closeLoginModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="auth-section">
                    <h3>Sign in with Google</h3>
                    <div id="googleSignInButton"></div>
                </div>
                <div class="auth-divider">
                    <span>or</span>
                </div>
                <div class="auth-section">
                    <h3>Email & Password</h3>
                    <p style="color: #888; font-size: 0.9em; margin-bottom: 1em;">
                        Use email verification code to register or login with password.
                    </p>
                    <button class="btn-secondary" id="emailLoginBtn" style="width: 100%;">
                        Continue with Email
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Username Setup Modal (for first-time Google login) -->
    <div id="usernameModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Set Your Username</h2>
            </div>
            <div class="modal-body">
                <p style="margin-bottom: 1em; color: #888;">
                    Please choose a username to complete your registration.
                </p>
                <form id="usernameForm">
                    <div class="form-group">
                        <label for="usernameInput">Username</label>
                        <input 
                            type="text" 
                            id="usernameInput" 
                            placeholder="Enter username (3-50 characters)"
                            minlength="3"
                            maxlength="50"
                            required
                        />
                        <small class="form-hint">3-50 characters, letters, numbers, and underscores only</small>
                    </div>
                    <div class="form-actions">
                        <button type="submit" class="btn-primary" id="submitUsernameBtn">
                            Continue
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script src="assets/js/script.js"></script>
    <script src="assets/js/auth.js"></script>
</body>
</html>
