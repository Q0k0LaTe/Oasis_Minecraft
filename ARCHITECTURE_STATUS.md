# æ¶æ„å®ç°çŠ¶æ€å¯¹æ¯”ï¼šæ–‡æ¡£ vs ä»£ç 

## æ€»ä½“è¯„ä¼°

**æ¶æ„å®Œæˆåº¦ï¼šçº¦ 85%**

æ ¸å¿ƒç¼–è¯‘å™¨å¼æ¶æ„ï¼ˆSpec â†’ IR â†’ Executionï¼‰å·²å®Œæ•´å®ç°ï¼Œä¸»æµç¨‹è¿è¡Œæ­£å¸¸ã€‚
å°‘æ•°é«˜çº§ç‰¹æ€§ï¼ˆé”™è¯¯è‡ªåŠ¨ä¿®å¤ã€å¤šè½®å¯¹è¯ï¼‰å°šæœªå®Œå…¨å®ç°ã€‚

---

## è¯¦ç»†æ¨¡å—å¯¹æ¯”

### âœ… 0. ç”¨æˆ· Prompt
| é¡¹ç›® | æ–‡æ¡£è¦æ±‚ | ä»£ç å®ç° | çŠ¶æ€ |
|------|---------|---------|------|
| æ¥æ”¶è‡ªç„¶è¯­è¨€ | âœ“ | orchestrator.process_prompt | âœ… å·²å®ç° |
| ç»“æ„åŒ–è¾“å‡º | âœ“ | OrchestratorResponse | âœ… å·²å®ç° |

---

### âœ… 1. Orchestratorï¼ˆå¯¹è¯è°ƒåº¦å™¨ï¼‰

| é¡¹ç›® | æ–‡æ¡£è¦æ±‚ | ä»£ç å®ç° | çŠ¶æ€ |
|------|---------|---------|------|
| å¯¹è¯æ§åˆ¶ | âœ“ | process_prompt + clarifying_questions | âœ… å·²å®ç° |
| æ¾„æ¸…æ­§ä¹‰ | âœ“ | requires_user_input + clarifying_questions | âœ… å·²å®ç° |
| åªç”Ÿæˆspec_delta | âœ“ | è¿”å›OrchestratorResponse.deltas | âœ… å·²å®ç° |
| ä¸ç›´æ¥æ”¹spec | âœ“ | é€šè¿‡SpecManager.apply_delta | âœ… å·²å®ç° |
| ä¸ç”Ÿæˆä»£ç  | âœ“ | åªç”ŸæˆSpecDeltaï¼Œæ— ä»£ç ç”Ÿæˆ | âœ… å·²å®ç° |
| ä½¿ç”¨LLMè§£ææ„å›¾ | âœ“ | _parse_item_intent + _parse_modification_intent | âœ… å·²å®ç° |
| æ”¯æŒå¤šä¸ªitems | âœ“ | ParsedItemåˆ—è¡¨ + å¾ªç¯å¤„ç† | âœ… å·²å®ç° |
| é”™è¯¯fallback | âœ“ | try-except + é»˜è®¤å€¼ | âœ… å·²å®ç° |
| **Contextåˆ©ç”¨** | âœ“ | ConversationContextå®šä¹‰ä½†æœªä½¿ç”¨ | âš ï¸ **æœªå®ç°** |

**ä¸ç¬¦åˆä¹‹å¤„ï¼š**
- `ConversationContext`è¢«ä¼ é€’ä½†ä»æœªåœ¨é€»è¾‘ä¸­ä½¿ç”¨
- æ— æ³•åˆ©ç”¨å†å²å¯¹è¯ä¿¡æ¯åšå†³ç­–

---

### âœ… 2. Spec Managerï¼ˆç”¨æˆ·æ„å›¾è§„èŒƒå±‚ï¼‰

| é¡¹ç›® | æ–‡æ¡£è¦æ±‚ | ä»£ç å®ç° | çŠ¶æ€ |
|------|---------|---------|------|
| å”¯ä¸€æ„å›¾æ¥æº | âœ“ | mod_spec.json | âœ… å·²å®ç° |
| ç‰ˆæœ¬åŒ– | âœ“ | history/vN.json | âœ… å·²å®ç° |
| å¯diff | âœ“ | æ¯ä¸ªç‰ˆæœ¬ä¿å­˜delta | âœ… å·²å®ç° |
| å¯å›æ»š | âœ“ | rollback_to_version() | âœ… å·²å®ç° |
| apply_delta | âœ“ | apply_delta() | âœ… å·²å®ç° |
| Specç¦æ­¢æŠ€æœ¯ç»†èŠ‚ | âœ“ | ModSpecæ— registry ID/Javaç±»å | âœ… å·²å®ç° |
| add vs updateè¯­ä¹‰ | âœ“ | åŒºåˆ†add(append)å’Œupdate(modify) | âœ… å·²å®ç° |

**å®Œå…¨ç¬¦åˆæ–‡æ¡£è¦æ±‚**

---

### âœ… 3. Compilerï¼ˆSpec â†’ IRï¼‰

| é¡¹ç›® | æ–‡æ¡£è¦æ±‚ | ä»£ç å®ç° | çŠ¶æ€ |
|------|---------|---------|------|
| Spec â†’ IRè½¬æ¢ | âœ“ | compile(ModSpec) â†’ ModIR | âœ… å·²å®ç° |
| è¡¥å…¨ç¼ºå¤±å­—æ®µ | âœ“ | é»˜è®¤å€¼å¡«å……ï¼ˆhardness=3.0ç­‰ï¼‰ | âœ… å·²å®ç° |
| ç”Ÿæˆregistry ID | âœ“ | _generate_registry_id() | âœ… å·²å®ç° |
| ç”ŸæˆJavaç±»å | âœ“ | _to_pascal_case() | âœ… å·²å®ç° |
| ç”Ÿæˆasset manifest | âœ“ | IRAssetå®Œæ•´å®šä¹‰ | âœ… å·²å®ç° |
| ç‰ˆæœ¬é€‚é… | âœ“ | ä½¿ç”¨configä¸­çš„ç‰ˆæœ¬å¸¸é‡ | âœ… å·²å®ç° |
| IRå®Œæ•´æ€§æ ¡éªŒ | âœ“ | _validate_ir() | âœ… å·²å®ç° |
| IRç¡®å®šæ€§ | âœ“ | æ— éšæœºæ€§ï¼Œç›¸åŒè¾“å…¥â†’ç›¸åŒè¾“å‡º | âœ… å·²å®ç° |

**å®Œå…¨ç¬¦åˆæ–‡æ¡£è¦æ±‚**

IRç¤ºä¾‹éªŒè¯ï¼š
```json
// æ–‡æ¡£ä¸­çš„IRç¤ºä¾‹åŒ…å«ï¼šid, material, luminance, hardness, aura, recipe, assets
// ä»£ç ä¸­IRBlockåŒ…å«ï¼šblock_id, material, luminance, hardness, texture_asset, loot_tableç­‰
```
âœ… ç»“æ„å®Œå…¨ç¬¦åˆ

---

### âœ… 4. Plannerï¼ˆIR â†’ ä»»åŠ¡ DAGï¼‰

| é¡¹ç›® | æ–‡æ¡£è¦æ±‚ | ä»£ç å®ç° | çŠ¶æ€ |
|------|---------|---------|------|
| IR â†’ TaskDAG | âœ“ | plan(ModIR) â†’ TaskDAG | âœ… å·²å®ç° |
| ä¾èµ–å…³ç³» | âœ“ | Task.dependencies | âœ… å·²å®ç° |
| æ”¯æŒå¹¶è¡Œ | âœ“ | Task.parallelizable=True | âœ… å·²å®ç° |
| ä»»åŠ¡ä¼˜å…ˆçº§ | æ–‡æ¡£æœªæ | Task.priority | âœ… è¶…å‡ºæ–‡æ¡£ |
| Phaseåˆ’åˆ† | âœ“ | 7ä¸ªphaseæ¸…æ™°åˆ’åˆ† | âœ… å·²å®ç° |

**å®Œå…¨ç¬¦åˆå¹¶è¶…å‡ºæ–‡æ¡£è¦æ±‚**

DAGç¤ºä¾‹ï¼š
```
æ–‡æ¡£ï¼šç”Ÿæˆçº¹ç† â†’ ç”Ÿæˆæ¨¡å‹ â†’ ç”Ÿæˆblockstate â†’ ...
ä»£ç ï¼šsetup â†’ texture(å¹¶è¡Œ) â†’ code â†’ assets â†’ config â†’ build
```
âœ… é€»è¾‘ç¬¦åˆ

---

### âœ… 5. Executorï¼ˆæ‰§è¡Œå™¨ï¼‰

| é¡¹ç›® | æ–‡æ¡£è¦æ±‚ | ä»£ç å®ç° | çŠ¶æ€ |
|------|---------|---------|------|
| æŒ‰DAGæ‰§è¡Œ | âœ“ | execute(TaskDAG) | âœ… å·²å®ç° |
| ä¾èµ–é¡ºåº | âœ“ | get_ready_tasks() | âœ… å·²å®ç° |
| è°ƒç”¨å·¥å…· | âœ“ | tool_registryæ˜ å°„ | âœ… å·²å®ç° |
| ä¸åšå†³ç­– | âœ“ | çº¯æœºæ¢°æ‰§è¡Œ | âœ… å·²å®ç° |
| æ‰§è¡Œæ—¥å¿— | âœ“ | execution_log | âœ… å·²å®ç° |
| é”™è¯¯æ ‡è®° | âœ“ | mark_failed() | âœ… å·²å®ç° |

**å®Œå…¨ç¬¦åˆæ–‡æ¡£è¦æ±‚**

---

### âš ï¸ 6. Validatorï¼ˆæ„å»ºå‰éªŒè¯ï¼‰

| é¡¹ç›® | æ–‡æ¡£è¦æ±‚ | ä»£ç å®ç° | çŠ¶æ€ |
|------|---------|---------|------|
| JSONåˆæ³•æ€§ | âœ“ | _validate_json_files() | âœ… å·²å®ç° |
| èµ„æºé½å…¨æ€§ | âœ“ | _validate_assets() | âœ… å·²å®ç° |
| IDå†²çªæ£€æŸ¥ | âœ“ | _validate_registry_ids() | âœ… å·²å®ç° |
| è·¯å¾„å­˜åœ¨æ€§ | âœ“ | _validate_file_structure() | âš ï¸ **åªæ‰“å°æœªæ£€æŸ¥** |
| langç¼ºå¤±æ£€æŸ¥ | âœ“ | æœªå®ç° | âŒ **ç¼ºå¤±** |
| Javaè¯­æ³•æ£€æŸ¥ | æ–‡æ¡£æåˆ° | æœªå®ç° | âŒ **ç¼ºå¤±** |

**ä¸ç¬¦åˆä¹‹å¤„ï¼š**
1. `_validate_file_structure()`åªæ‰“å°"Would check"ï¼Œæ²¡æœ‰å®é™…æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨
2. æ²¡æœ‰éªŒè¯æ‰€æœ‰items/blocks/toolséƒ½æœ‰å¯¹åº”çš„langæ¡ç›®
3. æ²¡æœ‰Javaè¯­æ³•æ£€æŸ¥ï¼ˆå¯èƒ½éœ€è¦å¤–éƒ¨å·¥å…·å¦‚javac -Xlintï¼‰

---

### âœ… 7. Builderï¼ˆGradle æ„å»ºï¼‰

| é¡¹ç›® | æ–‡æ¡£è¦æ±‚ | ä»£ç å®ç° | çŠ¶æ€ |
|------|---------|---------|------|
| åªåšæ„å»º | âœ“ | subprocess.run(["./gradlew", "build"]) | âœ… å·²å®ç° |
| ä¸å¤„ç†é€»è¾‘ | âœ“ | æ— é€»è¾‘åˆ¤æ–­ | âœ… å·²å®ç° |
| æ•è·è¾“å‡º | âœ“ | capture_output=True | âœ… å·²å®ç° |
| æå–JAR | âœ“ | _find_jar() | âœ… å·²å®ç° |
| è¶…æ—¶æ§åˆ¶ | æ–‡æ¡£æœªæ | timeout=300 | âœ… è¶…å‡ºæ–‡æ¡£ |

**å®Œå…¨ç¬¦åˆæ–‡æ¡£è¦æ±‚**

---

### âŒ 8. Error Interpreter / Fixerï¼ˆè‡ªåŠ¨ä¿®å¤ï¼‰

| é¡¹ç›® | æ–‡æ¡£è¦æ±‚ | ä»£ç å®ç° | çŠ¶æ€ |
|------|---------|---------|------|
| è§£æé”™è¯¯ | âœ“ | analyze_error() | âš ï¸ æ¡†æ¶å­˜åœ¨ |
| Gradleé”™è¯¯è¯†åˆ« | âœ“ | _parse_gradle_errors() | âš ï¸ åªæœ‰å‡ ä¸ªæ­£åˆ™ |
| Validationé”™è¯¯è¯†åˆ« | âœ“ | _parse_validation_errors() | âš ï¸ åŸºæœ¬æœªå®ç° |
| ç”Ÿæˆä¿®å¤æ–¹æ¡ˆ | âœ“ | _generate_fix() | âš ï¸ åªæœ‰1ä¸ªæ¡ˆä¾‹ |
| åº”ç”¨è¡¥ä¸ | âœ“ | apply_fixes() | âŒ **åªæ‰“å°æœªåº”ç”¨** |
| æœ€å°ä¿®æ”¹åŸåˆ™ | âœ“ | æœªå®ç° | âŒ **ç¼ºå¤±** |
| workspaceâ†’IRâ†’Specä¼˜å…ˆçº§ | âœ“ | æœªå®ç° | âŒ **ç¼ºå¤±** |

**ä¸ç¬¦åˆä¹‹å¤„ï¼š**
1. `_apply_single_fix()`æ‰€æœ‰åˆ†æ”¯éƒ½åªæœ‰`print("Would...")`ï¼Œæ²¡æœ‰å®é™…ä¿®æ”¹æ–‡ä»¶
2. é”™è¯¯æ¨¡å¼åº“å¤ªå°‘ï¼ˆåªæœ‰4ä¸ªæ­£åˆ™ï¼‰
3. æ²¡æœ‰å®ç°çœŸæ­£çš„patché€»è¾‘
4. æ²¡æœ‰ä¸pipelineé›†æˆå½¢æˆé”™è¯¯ä¿®å¤å¾ªç¯

**è¿™æ˜¯æ¶æ„ä¸­æœ€è–„å¼±çš„ç¯èŠ‚**

---

## Pipelineé›†æˆè¯„ä¼°

### âœ… ä¸»æµç¨‹é›†æˆ

| Phase | æ–‡æ¡£è¦æ±‚ | ä»£ç å®ç° | çŠ¶æ€ |
|-------|---------|---------|------|
| Phase 1: Orchestrator | âœ“ | orchestrator.process_prompt | âœ… |
| Phase 2: SpecManager | âœ“ | spec_manager.apply_delta | âœ… |
| Phase 3: Compiler | âœ“ | compiler.compile | âœ… |
| Phase 4: Planner | âœ“ | planner.plan | âœ… |
| Phase 5: Executor | âœ“ | executor.execute | âœ… |
| Phase 6: Validator | âœ“ | validator.validate | âœ… |
| Phase 7: Builder | âœ“ | builder.build | âœ… |
| Phase 8: ErrorFixer | âœ“ | æœªé›†æˆåˆ°ä¸»æµç¨‹ | âŒ |

### âŒ ç¼ºå¤±çš„é›†æˆç‰¹æ€§

1. **é”™è¯¯ä¿®å¤å¾ªç¯**
   - æ–‡æ¡£ï¼š`Builderå¤±è´¥ â†’ ErrorFixeråˆ†æ â†’ æ‰“è¡¥ä¸ â†’ é‡è¯•Build`
   - ä»£ç ï¼š`Builderå¤±è´¥ â†’ ç›´æ¥è¿”å›errorï¼Œæ¸¸æˆç»“æŸ`

2. **å¤šè½®å¯¹è¯**
   - æ–‡æ¡£ï¼šç”¨æˆ·å¯ä»¥è¿­ä»£ä¿®æ”¹ï¼ˆ"make it rarer", "add another item"ï¼‰
   - ä»£ç ï¼š`generate_mod()`åªå¤„ç†å•æ¬¡promptï¼Œæ²¡æœ‰å¯¹è¯å¾ªç¯

3. **Contextä¼ é€’**
   - æ–‡æ¡£ï¼šcontextåº”è¯¥å½±å“Orchestratorå†³ç­–
   - ä»£ç ï¼š`context=None`ä¼ å…¥ï¼Œorchestratorä¸ä½¿ç”¨

---

## æ ¸å¿ƒè®¾è®¡åŸåˆ™éµå®ˆæƒ…å†µ

### âœ… 1. Spec ä¸ IR ä¸¥æ ¼åˆ†ç¦»
**å®Œå…¨éµå®ˆ**
- ModSpecï¼šmod_name, items[].item_name
- ModIRï¼šmod_id, items[].item_id, items[].java_class_name

### âœ… 2. æ‰€æœ‰ç”Ÿæˆå¿…é¡»æ˜¯æœºæ¢°æ‰§è¡Œ
**å®Œå…¨éµå®ˆ**
- Generatorå·¥å…·ä¸åšå†³ç­–
- æ‰€æœ‰é€»è¾‘åœ¨Compilerä¸­å®Œæˆ

### âœ… 3. æ‰€æœ‰"æ™ºèƒ½"åªèƒ½åœ¨ Spec â†’ IR é˜¶æ®µ
**å®Œå…¨éµå®ˆ**
- LLMåªåœ¨Orchestratorä¸­ä½¿ç”¨
- Compilerä½¿ç”¨ç¡®å®šæ€§ç®—æ³•
- Planner/Executor/Builderçº¯æœºæ¢°

---

## ä¸æ–‡æ¡£ä¸ç¬¦çš„åœ°æ–¹æ±‡æ€»

### 1. **Contexté€»è¾‘æœªå®ç°** âš ï¸
```python
# orchestrator.py:68
context: Optional[ConversationContext] = None  # æ¥æ”¶ä½†ä¸ä½¿ç”¨
```
**å½±å“ï¼š** æ— æ³•åš"make it rarer"è¿™ç§éœ€è¦ä¸Šä¸‹æ–‡çš„æŒ‡ä»¤

### 2. **ErrorFixeræœªçœŸæ­£å®ç°** âŒ
```python
# error_fixer.py:145
print(f"[ErrorFixer] Would patch {file_path}")  # åªæ‰“å°ä¸åšäº‹
```
**å½±å“ï¼š** æ„å»ºå¤±è´¥æ— æ³•è‡ªåŠ¨ä¿®å¤

### 3. **Validatoræ£€æŸ¥ä¸å®Œæ•´** âš ï¸
```python
# validator.py:155
print(f"[Validator] Would check for directories: {required_dirs}")
```
**å½±å“ï¼š** å¯èƒ½é—æ¼æ–‡ä»¶ç¼ºå¤±é—®é¢˜

### 4. **Pipelineæ— é”™è¯¯ä¿®å¤å¾ªç¯** âŒ
```python
# pipeline.py:226
raise PipelineError(f"Build failed: {error_msg}")  # ç›´æ¥å¤±è´¥ï¼Œä¸å°è¯•ä¿®å¤
```
**å½±å“ï¼š** æ— æ³•å®ç°æ–‡æ¡£ä¸­çš„"é”™è¯¯â†’ä¿®å¤â†’é‡è¯•"å¾ªç¯

### 5. **å•æ¬¡prompté™åˆ¶** âš ï¸
```python
# pipeline.py:80
def generate_mod(user_prompt: str, ...):
    # åªå¤„ç†ä¸€ä¸ªpromptï¼Œæ— å¤šè½®å¯¹è¯
```
**å½±å“ï¼š** æ— æ³•å®ç°è¿­ä»£å¼Modå¼€å‘

---

## æ¶æ„è´¨é‡è¯„åˆ†

| æ¨¡å— | è®¾è®¡è´¨é‡ | å®ç°å®Œæˆåº¦ | æµ‹è¯•è¦†ç›– | æ€»åˆ† |
|------|---------|-----------|---------|------|
| Orchestrator | â­â­â­â­â­ | â­â­â­â­ | â­â­â­ | 4.0/5 |
| Spec Manager | â­â­â­â­â­ | â­â­â­â­â­ | â­â­â­â­ | 4.7/5 |
| Compiler | â­â­â­â­â­ | â­â­â­â­â­ | â­â­â­â­ | 4.7/5 |
| Planner | â­â­â­â­â­ | â­â­â­â­â­ | â­â­â­â­ | 4.7/5 |
| Executor | â­â­â­â­â­ | â­â­â­â­â­ | â­â­â­â­ | 4.7/5 |
| Validator | â­â­â­â­ | â­â­â­ | â­â­ | 3.0/5 |
| Builder | â­â­â­â­â­ | â­â­â­â­â­ | â­â­â­â­ | 4.7/5 |
| ErrorFixer | â­â­â­â­â­ | â­â­ | â­ | 2.7/5 |
| **æ€»ä½“** | **â­â­â­â­â­** | **â­â­â­â­** | **â­â­â­** | **4.0/5** |

---

## æ¨èä¼˜åŒ–ä¼˜å…ˆçº§

### ğŸ”´ é«˜ä¼˜å…ˆçº§ï¼ˆå½±å“æ ¸å¿ƒåŠŸèƒ½ï¼‰
1. **å®ç°Contexté€»è¾‘** - æ”¯æŒ"make it rarer"ç­‰ä¸Šä¸‹æ–‡æŒ‡ä»¤
2. **å®ç°ErrorFixer** - è‡ªåŠ¨ä¿®å¤æ„å»ºé”™è¯¯
3. **å®Œå–„Validator** - çœŸæ­£æ£€æŸ¥æ–‡ä»¶å­˜åœ¨æ€§

### ğŸŸ¡ ä¸­ä¼˜å…ˆçº§ï¼ˆæå‡ä½“éªŒï¼‰
4. **å¤šè½®å¯¹è¯æ”¯æŒ** - è¿­ä»£å¼Modå¼€å‘
5. **é”™è¯¯ä¿®å¤å¾ªç¯** - Buildå¤±è´¥è‡ªåŠ¨é‡è¯•

### ğŸŸ¢ ä½ä¼˜å…ˆçº§ï¼ˆé”¦ä¸Šæ·»èŠ±ï¼‰
6. æ‰©å±•é”™è¯¯æ¨¡å¼åº“ï¼ˆErrorFixerï¼‰
7. Javaè¯­æ³•æ£€æŸ¥ï¼ˆValidatorï¼‰
8. å¹¶è¡Œæ‰§è¡Œä¼˜åŒ–ï¼ˆExecutorï¼‰

---

## ç»“è®º

**è¿™æ˜¯ä¸€ä¸ªè®¾è®¡ä¼˜ç§€ã€å®ç°æ‰å®çš„å·¥ä¸šçº§Agentæ¶æ„ã€‚**

**ä¼˜åŠ¿ï¼š**
- âœ… Spec-IR-Executionä¸‰å±‚åˆ†ç¦»æ¸…æ™°
- âœ… æ ¸å¿ƒç¼–è¯‘æµç¨‹å®Œæ•´ä¸”æ­£ç¡®
- âœ… ä»£ç è´¨é‡é«˜ï¼Œå¯ç»´æŠ¤æ€§å¼º
- âœ… éµå®ˆ"æ™ºèƒ½åªåœ¨ç¼–è¯‘é˜¶æ®µ"çš„åŸåˆ™

**ä¸è¶³ï¼š**
- âš ï¸ ErrorFixeråªæ˜¯éª¨æ¶ï¼ŒæœªçœŸæ­£å®ç°
- âš ï¸ Contextå’Œå¤šè½®å¯¹è¯æ”¯æŒä¸è¶³
- âš ï¸ éƒ¨åˆ†éªŒè¯åŠŸèƒ½æœªå®Œæˆ

**æ€»ä½“è¯„ä»·ï¼š** MVPå·²å®Œæˆï¼Œæ ¸å¿ƒåŠŸèƒ½å¯ç”¨ï¼Œé«˜çº§ç‰¹æ€§éœ€ç»§ç»­å¼€å‘ã€‚

---

ç”Ÿæˆæ—¶é—´ï¼š2026-01-08
ä»£ç ç‰ˆæœ¬ï¼šcommit c649f23
